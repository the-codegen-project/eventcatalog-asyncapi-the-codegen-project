asyncapi: 3.0.0
info:
  title: Orders Service
  version: 1.0.0
  description: This service is in charge of processing orders and orchestrating the order lifecycle.

operations:
  receiveOrderCreated:
    action: receive
    channel:
      $ref: '#/channels/orderCreated'
    messages:
      - $ref: '#/channels/orderCreated/messages/OrderCreated'

  sendOrderCancelled:
    action: send
    channel:
      $ref: '#/channels/orderCancelled'
    messages:
      - $ref: '#/channels/orderCancelled/messages/OrderCancelled'

  sendOrderCompleted:
    action: send
    channel:
      $ref: '#/channels/orderCompleted'
    messages:
      - $ref: '#/channels/orderCompleted/messages/OrderCompleted'

  receivePaymentFailed:
    action: receive
    channel:
      $ref: '#/channels/paymentFailed'
    messages:
      - $ref: '#/channels/paymentFailed/messages/PaymentFailed'

  receiveShipmentDelivered:
    action: receive
    channel:
      $ref: '#/channels/shipmentDelivered'
    messages:
      - $ref: '#/channels/shipmentDelivered/messages/ShipmentDelivered'

channels:
  orderCreated:
    address: order.created
    messages:
      OrderCreated:
        $ref: '#/components/messages/OrderCreated'

  orderCancelled:
    address: order.cancelled
    messages:
      OrderCancelled:
        $ref: '#/components/messages/OrderCancelled'

  orderCompleted:
    address: order.completed
    messages:
      OrderCompleted:
        $ref: '#/components/messages/OrderCompleted'

  paymentFailed:
    address: payment.failed
    messages:
      PaymentFailed:
        $ref: '#/components/messages/PaymentFailed'

  shipmentDelivered:
    address: shipment.delivered
    messages:
      ShipmentDelivered:
        $ref: '#/components/messages/ShipmentDelivered'

components:
  schemas:
    OrderItem:
      type: object
      properties:
        itemId:
          type: string
          description: Unique identifier for the item
        quantity:
          type: integer
          description: Quantity of the item ordered
        price:
          type: number
          format: float
          description: Price of the item
      additionalProperties: false
  messages:
    OrderCreated:
      description: 'Event triggered when an order is created'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          userId:
            type: string
            description: Unique identifier for the user who placed the order
          totalAmount:
            type: number
            format: float
            description: Total amount of the order
          items:
            type: array
            description: List of items in the order
            items:
              $ref: '#/components/schemas/OrderItem'
        additionalProperties: false

    OrderCancelled:
      description: 'Event triggered when an order is cancelled'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          reason:
            type: string
            description: Reason for the order cancellation
        additionalProperties: false

    OrderCompleted:
      description: 'Event triggered when an order is completed'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          completionTime:
            type: string
            format: date-time
            description: Time when the order was completed
        additionalProperties: false

    PaymentFailed:
      description: 'Event received when a payment fails'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          paymentId:
            type: string
            description: Unique identifier for the payment
          orderId:
            type: string
            description: Unique identifier for the related order
          failureReason:
            type: string
            description: Reason for the payment failure
        additionalProperties: false

    ShipmentDelivered:
      description: 'Event received when a shipment is delivered'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          shipmentId:
            type: string
            description: Unique identifier for the shipment
          deliveryTime:
            type: string
            format: date-time
            description: Time when the shipment was delivered
        additionalProperties: false
