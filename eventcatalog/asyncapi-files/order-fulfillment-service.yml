asyncapi: 3.0.0
info:
  title: Order Fulfillment Service
  version: 1.0.0
  description: This service handles the logistics and processing required to fulfill customer orders.

operations:
  receiveInventoryReserved:
    action: receive
    channel:
      $ref: '#/channels/inventoryReserved'
    messages:
      - $ref: '#/channels/inventoryReserved/messages/InventoryReserved'

  sendOrderShipped:
    action: send
    channel:
      $ref: '#/channels/orderShipped'
    messages:
      - $ref: '#/channels/orderShipped/messages/OrderShipped'

  sendShipmentDelivered:
    action: send
    channel:
      $ref: '#/channels/shipmentDelivered'
    messages:
      - $ref: '#/channels/shipmentDelivered/messages/ShipmentDelivered'

channels:
  inventoryReserved:
    address: inventory.reserved
    messages:
      InventoryReserved:
        $ref: '#/components/messages/InventoryReserved'

  orderShipped:
    address: order.shipped
    messages:
      OrderShipped:
        $ref: '#/components/messages/OrderShipped'

  shipmentDelivered:
    address: shipment.delivered
    messages:
      ShipmentDelivered:
        $ref: '#/components/messages/ShipmentDelivered'

components:
  messages:
    InventoryReserved:
      description: 'Event received when inventory is reserved, triggering fulfillment'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          reservationId:
            type: string
            description: Unique identifier for the inventory reservation
          orderId:
            type: string
            description: Unique identifier for the order
          items:
            type: array
            description: List of items reserved
            items:
              type: object
              properties:
                itemId:
                  type: string
                  description: Unique identifier for the item
                quantity:
                  type: integer
                  description: Quantity of the item reserved
              additionalProperties: false
        additionalProperties: false

    OrderShipped:
      description: 'Event triggered when an order is shipped'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          shipmentId:
            type: string
            description: Unique identifier for the shipment
          shipmentTime:
            type: string
            format: date-time
            description: Time when the order was shipped
          carrier:
            type: string
            description: Name of the carrier handling the shipment
        additionalProperties: false

    ShipmentDelivered:
      description: 'Event triggered when a shipment is delivered to the customer'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          shipmentId:
            type: string
            description: Unique identifier for the shipment
          deliveryTime:
            type: string
            format: date-time
            description: Time when the shipment was delivered
        additionalProperties: false
