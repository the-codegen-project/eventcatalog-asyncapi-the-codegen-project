asyncapi: 3.0.0
info:
  title: Payment Service
  version: 1.0.0
  description: This service handles the payment processing for orders.

operations:
  receiveOrderCreated:
    action: receive
    channel:
      $ref: '#/channels/orderCreated'
    messages:
      - $ref: '#/channels/orderCreated/messages/OrderCreated'

  sendPaymentProcessed:
    action: send
    channel:
      $ref: '#/channels/paymentProcessed'
    messages:
      - $ref: '#/channels/paymentProcessed/messages/PaymentProcessed'

  sendPaymentFailed:
    action: send
    channel:
      $ref: '#/channels/paymentFailed'
    messages:
      - $ref: '#/channels/paymentFailed/messages/PaymentFailed'

  receiveOrderCancelled:
    action: receive
    channel:
      $ref: '#/channels/orderCancelled'
    messages:
      - $ref: '#/channels/orderCancelled/messages/OrderCancelled'

  sendRefundInitiated:
    action: send
    channel:
      $ref: '#/channels/refundInitiated'
    messages:
      - $ref: '#/channels/refundInitiated/messages/RefundInitiated'

channels:
  orderCreated:
    address: order.created
    messages:
      OrderCreated:
        $ref: '#/components/messages/OrderCreated'

  paymentProcessed:
    address: payment.processed
    messages:
      PaymentProcessed:
        $ref: '#/components/messages/PaymentProcessed'

  paymentFailed:
    address: payment.failed
    messages:
      PaymentFailed:
        $ref: '#/components/messages/PaymentFailed'

  orderCancelled:
    address: order.cancelled
    messages:
      OrderCancelled:
        $ref: '#/components/messages/OrderCancelled'

  refundInitiated:
    address: refund.initiated
    messages:
      RefundInitiated:
        $ref: '#/components/messages/RefundInitiated'

components:
  messages:
    OrderCreated:
      description: 'Event received when a new order is created, triggering payment processing'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          userId:
            type: string
            description: Unique identifier for the user who placed the order
          totalAmount:
            type: number
            format: float
            description: Total amount of the order
          items:
            type: array
            description: List of items in the order
            items:
              type: object
              properties:
                itemId:
                  type: string
                  description: Unique identifier for the item
                quantity:
                  type: integer
                  description: Quantity of the item ordered
                price:
                  type: number
                  format: float
                  description: Price of the item
              additionalProperties: false
        additionalProperties: false

    PaymentProcessed:
      description: 'Event triggered when a payment is successfully processed'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          paymentId:
            type: string
            description: Unique identifier for the payment
          status:
            type: string
            description: Status of the payment
        additionalProperties: false

    PaymentFailed:
      description: 'Event triggered when a payment fails'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          paymentId:
            type: string
            description: Unique identifier for the payment
          orderId:
            type: string
            description: Unique identifier for the related order
          failureReason:
            type: string
            description: Reason for the payment failure
        additionalProperties: false

    OrderCancelled:
      description: 'Event received when an order is cancelled, triggering refund if payment was made'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          orderId:
            type: string
            description: Unique identifier for the order
          reason:
            type: string
            description: Reason for the order cancellation
        additionalProperties: false

    RefundInitiated:
      description: 'Event triggered when a refund is initiated due to order cancellation'
      x-eventcatalog-message-type: event
      headers:
        type: object
        properties:
          ec-message-type:
            type: string
            default: event
            description: Type of message for EventCatalog
        additionalProperties: false
      payload:
        type: object
        properties:
          refundId:
            type: string
            description: Unique identifier for the refund
          paymentId:
            type: string
            description: Unique identifier for the related payment
          orderId:
            type: string
            description: Unique identifier for the related order
          amount:
            type: number
            format: float
            description: Amount to be refunded
        additionalProperties: false
